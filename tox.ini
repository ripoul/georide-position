[tox]
skipsdist = true
envlist =
    isort
    black
    sort_requirements
    test

[testenv:isort]
basepython = python3
usedevelop = false
deps = isort==4.2.5
changedir = {toxinidir}
commands = isort --recursive --check-only --diff apps

[testenv:black]
basepython = python3
usedevelop = false
deps = black==19.3b0
changedir = {toxinidir}
commands = black --check --verbose apps/

[testenv:sort_requirements]
basepython = python3
usedevelop = false
deps = sort-requirements==1.3.0
changedir = {toxinidir}
commands = sort-requirements -c requirements.txt develop_requirements.txt

[testenv:test]
passenv = DJANGO_SETTINGS_MODULE PYTHONPATH GAE_ENV HOME
          C_INCLUDE_PATH CPLUS_INCLUDE_PATH XDG_CACHE_HOME
          GEORIDE_PASSWORD GEORIDE_EMAIL
setenv =
    PYTHONDONTWRITEBYTECODE=1
    DJANGO_SETTINGS_MODULE=georide_position.test_settings
basepython = python3
deps =
    -rdevelop_requirements.txt
    -eapps
commands =
    python manage.py migrate
    coverage run manage.py test --noinput apps/
    coverage html
    coverage report --fail-under=80
